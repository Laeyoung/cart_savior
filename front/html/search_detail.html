<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Cart Savior | 상세</title>
	<link rel="stylesheet" href="../css/style.css">
	<script src="https://d3js.org/d3.v5.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
</head>
<body>
	<header class="header">
		<h1 class="logo">
			<a href="#">
				<img class="hidden-m" src="../images/logo_pc.svg" alt="cart savior">
				<img class="hidden-p visible-m" src="../images/logo_m.svg" alt="cart savior">
			</a>
		</h1>
		<div class="search_bar">
			<form action="/search">
				<input class="inp_search" type="text" name="" id="" placeholder="오늘의 무 값은?"/>
				<button class="btn_search" type="submit">검색하기</button>
			</form>
		</div>
	</header>
	<section class="container detail_wrap">
		<div class="flex-item">
			<div class="item_info type_100">
				<h3 class="title">깐마늘</h3>
				<span class="sub_title">깐마늘 (국산) (1kg)</span>
			</div>
		</div>
		<div class="detail_info_wrap flex-layout">
			<div class="flex-item col-p-4 col-m-12">
				<div class="detail_item">
					<div class="detail_info">
						<span class="date">4월 20일 기준</span>
						<strong class="price">평균가는<br/><span class="txt_green">999,999,000원</span>입니다.</strong>
						<strong class="price">전주 대비<br/><span class="txt_up">500원 더 비싸요.</span></strong>
						<span class="date">지난 주 평균가 : 230,000원</span>
					</div>
					<span class="detail_source">자료 : 한국농수산식품유통공사</span>
				</div>
			</div>
			<div class="flex-item col-p-8 col-m-12">
				<div class="detail_graph">
					<h3 class="title_md txt_white">지난 깐마늘 가격을 확인해보세요.</h3>
					<!-- <canvas id="myChart" width="400" height="200"></canvas> -->
					<div id="canvas"></div>
				</div>
			</div>
		</div>
	</section>
	<footer class="footer">
		<p>Copyright (C) 2020. CART SAVIOR all rights reserved.</p>
	</footer>
</body>
<script>
	// var ctx = document.getElementById('myChart').getContext('2d');
	// var myChart = new Chart(ctx, {
	// 	type: 'line',
	// 	data: {
	// 		labels: ['오늘', '하루 전', '한달 전', '일년 전'],
	// 		datasets: [{
	// 			// label: '# of Votes',
	// 			data: [23000, 19000, 10000, 30000],
	// 			// backgroundColor: [
	// 			// 	'rgba(255, 255, 255)',
	// 			// ],
	// 			borderColor: [
	// 				'rgba(255, 255, 255)',
	// 			],
	// 			borderWidth: 2
	// 		}]
	// 	},
	// 	options: {
	// 		scales: {
	// 			yAxes: [{
	// 				ticks: {
	// 					// stacked: true
	// 					beginAtZero: true
	// 				}
	// 			}]
	// 		}
	// 	}
	// });
	//------------------------1. PREPARATION------------------------//
//-----------------------------SVG------------------------------// 
const width = 960;
const height = 500;
const margin = 5;
const padding = 5;
const adj = 30;
// we are appending SVG first
const svg = d3.select("div#canvas").append("svg")
    .attr("preserveAspectRatio", "xMinYMin meet")
    .attr("viewBox", "-"
          + adj + " -"
          + adj + " "
          + (width + adj *3) + " "
          + (height + adj*3))
    .style("padding", padding)
    .style("margin", margin)
    .classed("svg-content", true);

//-----------------------------DATA-----------------------------//
const timeConv = d3.timeParse("%d-%b-%Y");
const dataset = d3.csv("data.csv");
dataset.then(function(data) {
    var slices = data.columns.slice(1).map(function(id) {
        return {
            id: id,
            values: data.map(function(d){
                return {
                    date: timeConv(d.date),
                    measurement: +d[id]
                };
            })
        };
    });
   
//----------------------------SCALES----------------------------//
const xScale = d3.scaleTime().range([0,width]);
const yScale = d3.scaleLinear().rangeRound([height, 0]);
xScale.domain(d3.extent(data, function(d){
    return timeConv(d.date)}));
yScale.domain([(0), d3.max(slices, function(c) {
    return d3.max(c.values, function(d) {
        return d.measurement + 4; });
        })
    ]);
   
//-----------------------------AXES-----------------------------//
const yaxis = d3.axisLeft()
    .ticks((slices[0].values).length)
    .scale(yScale);
   
const xaxis = d3.axisBottom()
    .ticks(d3.timeDay.every(1))
    .tickFormat(d3.timeFormat('%b %d'))
    .scale(xScale);
   
//----------------------------LINES-----------------------------//
const line = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale(d.measurement); }); 

let id = 0;
const ids = function () {
    return "line-"+id++;
}  
//-------------------------2. DRAWING---------------------------//
//-----------------------------AXES-----------------------------//
svg.append("g")
    .attr("class", "axis")
    .attr("transform", "translate(0," + height + ")")
    .call(xaxis);
   
svg.append("g")
    .attr("class", "axis")
    .call(yaxis)
    .append("text")
    .attr("transform", "rotate(-90)")
    .attr("dy", ".75em")
    .attr("y", 6)
    .style("text-anchor", "end")
    .text("Frequency");
   
//----------------------------LINES-----------------------------//
const lines = svg.selectAll("lines")
    .data(slices)
    .enter()
    .append("g");
   
    lines.append("path")
    .attr("class", ids)
    .attr("d", function(d) { return line(d.values); });
   
    lines.append("text")
    .attr("class","serie_label")
    .datum(function(d) {
        return {
            id: d.id,
            value: d.values[d.values.length - 1]}; })
    .attr("transform", function(d) {
            return "translate(" + (xScale(d.value.date) + 10)  
            + "," + (yScale(d.value.measurement) + 5 ) + ")"; })
    .attr("x", 5)
    .text(function(d) { return ("Serie ") + d.id; });

});
</script>
</html>
